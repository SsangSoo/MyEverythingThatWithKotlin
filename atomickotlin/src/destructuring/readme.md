# 아토믹 코틀린 At 36. 구조 분해 선언

## 용어

- 없음.

## 예약어 및 코틀린 개념

#### 구조 분해(destructuring)
- 구조 분해(destructuring) 선언을 사용하면 여러 식별자를 동시에 선언하면서 초기화할 수도 있다.

```kotlin
val (a, b, c) = 여러_값이_들어있는_값
```

- 위의 코드는 여러 값이 들어 있는 값(객체)을 여러 컴포넌트로 분해해서 각 컴포넌트를 순서대로 대입해준다.
- 이 구분은 식별자를 하나만 선언하는 구문과 다르다.
- 구조 분해 구문에서는 (등호 왼쪽에 있는) 식별자 이름을 괄호 안에 넣어야 한다.

- data 클래스 또한 자동으로 구조 분해 선언을 지원한다.
- data 클래스의 인스턴스를 구조 분해할 때는 data 클래스에 생성자에 각 프로퍼티가 나열된 순서대로 값이 대입된다.

```kotlin
package destructuring

import atomictest.eq


data class Tuple(
    val i: Int,
    val d: Double,
    val s: String,
    val b: Boolean,
    val l: List<Int>,
)

fun main() {
    val tuple = Tuple(
        1, 3.14, "Mouse", false, listOf())
    val(i, d, s, b, l) = tuple
    i eq 1
    d eq 3.14
    s eq "Mouse"
    b eq false
    l eq listOf()

    val(_,_, animal) = tuple // 1
    animal eq "Mouse"
}
```

구조 분해 선언으로 선언할 식별자 중 일부가 필요하지 않은 경우, 이를 대신 `밑줄(_)`을 사용할 수 있고, 맨 뒤쪽의 이름들은 아예 생략할 수 있다.
**여기서는 밑줄을 사용해 1과 3.14를 무시하고, "Mouse"가 animal에 대입되며, 목록 맨 뒤에 있는 두 변수를 생략했기 때문에 false와 빈 List도 무시된다.
- data 클래스의 프로퍼티는 이름에 의해 대입되는 것이 아니라 순서대로 대입된다.

구조 분해 선언은 지역 var나 val에만 적용할 수 있으며, 클래스 프로퍼티를 정의할 때는 사용할 수 없다.

#### Pair
- 표준 라이브러리에 있는 클래스로서 두 값을 반환할 수 있다.
- Pair는 List나 Set처럼 파라미터화된 타입이다.


#### Triple
- Triple 클래스는 정확히 세 가지 값을 묶는다.
- 코틀린은 **Pair**와 **Triple**만 제공하는데, 이는 코틀린 설계자들이 의도한 일이다.
  - 더 많은 값을 저장하고 싶거나 코드에서 Pair와 Triple을 많이 사용함다면 각 상황에 맞는 특별한 클래스를 작성하라는 뜻이다.

---
for 루프를 사용하면 쌍(Pair나 Triple 등을 '쌍'이라고 하며, `튜플(tuple)`이라고도 부른다)이나 data 클래스의 객체로 이뤄진 Map 또는 List에 대해 이터레이션하면서 값의 각 부분을 구조 분해로 얻을 수 있다.
---


  
## 함수

#### withIndex()
- `withIndex()`는 표준 라이브러리가 List에 대해 제공하는 **확장 함수**다.
- 이 함수는 컬렉션의 값을 `IndexedValue`라는 타입의 객체에 담아서 반환하며, 이 객체를 구조 분해할 수 있다.



## 참고

- 결괏값의 타입에 좋은 이름을 붙이는 것은 함수에 자신의 역할을 잘 설명하는 이름을 붙이는 것만큼이나 중요한 일이다.
- 어떤 객체를 구조 분해에 사용했는데 이 후 그 data 클래스에서 맨 마지막이 아닌 위치에 프로퍼티를 추가하는 경우, 추가된 새 프로퍼티가 기존에 다른 값을 대입받선 식별자에 대입되면서 예상과 다른 결과를 낳을 수 있다. 이런 오류를 컴파일러가 잡아주면 좋겠지만, 우리가 작성한 data 클래스에 추가된 프로퍼티 타입과 원래 그 위치에 있던 프로퍼티 타입이 같으면 컴파일러는 이 문제를 감지할 수 없다. Pair나 Triple 같은 라이브러리가 제공하는 data 클래스는 프로퍼티가 순서가 바뀌지 않으므로 구조 분해에도 안전하다.
